services:
  chrome:
    image: browserless/chrome:latest
    container_name: qa-chrome
    ports:
      - "3000:3000"
    environment:
      - DEFAULT_LAUNCH_ARGS=["--no-sandbox", "--disable-dev-shm-usage", "--window-size=1920,1080"]
      - ENABLE_VIDEO=true
    restart: unless-stopped

  test-website:
    image: nginx:alpine
    container_name: qa-website
    ports:
      - "8080:80"
    volumes:
      - ./demo-site:/usr/share/nginx/html:ro
    restart: unless-stopped

  test-runner:
    image: mcr.microsoft.com/playwright/python:v1.45.0-jammy
    container_name: qa-test-runner
    depends_on:
      - chrome
      - test-website
    environment:
      - BASE_URL=http://test-website:80
      - CHROME_WS_URL=ws://chrome:3000
    volumes:
      - ./tests:/app/tests
      - ./results:/app/results
      - ./demo-site:/app/demo-site
    working_dir: /app
    command: ["tail", "-f", "/dev/null"]
    restart: unless-stopped