
services:
  chrome:
    image: browserless/chrome:latest
    container_name: qa-chrome
    ports:
      - "3000:3000"
    environment:
      - DEFAULT_LAUNCH_ARGS=--no-sandbox,--disable-dev-shm-usage,--window-size=1920,1080
      - ENABLE_VIDEO=true
      - ENABLE_SCREENSHOTS=true
      - CONNECTION_TIMEOUT=300000
    volumes:
      - ./results/videos:/tmp/videos
      - ./results/screenshots:/tmp/screenshots
    restart: unless-stopped
    networks:
      - qa-network

  firefox:
    image: browserless/firefox:latest
    container_name: qa-firefox
    ports:
      - "3001:3000"
    environment:
      - DEFAULT_LAUNCH_ARGS=--no-sandbox,--disable-dev-shm-usage,--window-size=1920,1080
      - ENABLE_VIDEO=true
    restart: unless-stopped
    networks:
      - qa-network

  mock-api:
    image: mockserver/mockserver:latest
    container_name: qa-mock-api
    ports:
      - "1080:1080"
    command: -serverPort 1080 -logLevel INFO
    restart: unless-stopped
    networks:
      - qa-network

  test-website:
    image: nginx:alpine
    container_name: qa-website
    ports:
      - "8080:80"
    volumes:
      - ./demo-site:/usr/share/nginx/html:ro
    restart: unless-stopped
    networks:
      - qa-network

  test-runner:
    image: mcr.microsoft.com/playwright/python:v1.45.0-jammy
    container_name: qa-test-runner
    depends_on:
      - chrome
      - firefox
      - mock-api
      - test-website
    environment:
      - BASE_URL=http://test-website:80
      - CHROME_WS_URL=ws://chrome:3000
      - FIREFOX_WS_URL=ws://firefox:3000
      - MOCK_API_URL=http://mock-api:1080
    volumes:
      - ./tests:/app/tests
      - ./results:/app/results
      - ./demo-site:/app/demo-site
      - ./allure-results:/app/allure-results
    working_dir: /app
    command: ["tail", "-f", "/dev/null"]
    restart: unless-stopped
    networks:
      - qa-network

networks:
  qa-network:
    driver: bridge